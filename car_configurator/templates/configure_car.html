{% extends 'base.html' %}
{% block content %}

{% load static %}

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Car Carousel</title>
    <style>
      .main-content {
        display: flex;
        flex-direction: row;
        justify-content: space-between;
        align-items: flex-start;
        gap: 40px;
        padding: 20px;
      }

      .right-side {
        display: flex;
        flex-direction: column;
      }

      .carousel {
        position: relative;
        flex: 0 0 60%;
        margin-left: 40px;
        overflow: hidden;
        border-radius: 12px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
      }

      .carousel-track {
        display: flex;
        transition: transform 0.5s ease-in-out;
      }

      .carousel-image {
        width: 100%;
        flex-shrink: 0;
        object-fit: cover;
      }

      .carousel-btn {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        background-color: rgba(0, 0, 0, 0.4);
        color: white;
        border: none;
        font-size: 2rem;
        cursor: pointer;
        padding: 8px 12px;
        z-index: 1;
        border-radius: 50%;
        
      }

      .carousel-btn:hover {
        background-color: rgba(0, 0, 0, 0.6);
      }

      .carousel-btn.prev {
        left: 10px;
      }

      .carousel-btn.next {
        right: 10px;
      }


      .options-container {
        width: 100% ;
        display: flex; 
        
        justify-content: center; 
        background-color: white;
        padding: 20px;
      }
      
      .color-circle {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        border: 2px solid #fff; /* white border makes it visible on dark background */
        margin-right: 10px;
        display: inline-block;
        cursor: pointer;
        box-shadow: 0 0 5px rgba(0,0,0,0.5); /* optional glow to separate from background */
      }
      
      .color-circle:hover {
        transform: scale(1.1); /* Slightly enlarge circle on hover */
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2); /* Add shadow on hover */
      }
     

      .section {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 10px;
      }

      .option-header {
        margin-bottom: 20px;
      }

      .wheels-container, .engines-container, .colors-container {
        display: flex;
        gap: 10px;
        justify-content: center;
        align-items: center;
      }

      .wheels-container, .engines-container {
        display: flex;
        flex-direction: column;
      }

      .wheel-name, .engine-name {
        padding: 10px;
        border-radius: 8px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        cursor: pointer;
        transition: transform 0.2s ease;
      }

      .wheel-name:hover, .engine-name:hover {
        transform: scale(1.1);
      }

      



      .config-summary-container {
        margin-left:auto;
        padding: 20px;
        border: 1px solid #ccc;
        border-radius: 8px;
        background-color: #f9f9f9;
    }

      .config-summary-container h3 {
        text-align: center;
      }

      .config-summary-container p {
        margin: 10px 0;
        font-size: 1.1em;
      }

      .config-summary-container strong {
        font-size: 1.2em;
      }

    </style>
  </head>
  <body>
    
    <div class="main-content">
      <div class="carousel">
        <div class="carousel-track">
        </div>
        <button class="carousel-btn prev">&#10094;</button>
        <button class="carousel-btn next">&#10095;</button>
      </div>
    

      <div class="right-side">
      
      <div class="options-container">

        <div class="section">
          <div class="option-header"><strong>COLORS</strong></div>
          <div class="colors-container">
            {% for color in colors %}
              <div class="color-circle-container" style="text-align: center; cursor: pointer;">
                <div
                  class="color-circle"
                  data-color-id="{{ color.id }}"
                  data-images='[{% for img in color.images.all %}"{{ img.image.url }}"{% if not forloop.last %}, {% endif %}{% endfor %}]'
                  style="background-color: {{ color.hex_code }};"
                  title="{{ color.name }}"
                ></div>
              </div>
              <div class="color-info" id="colorInfo-{{ color.id }}" style="display: none; font-weight: bold; font-size: 1.1em; margin-top: 100px; position: absolute;">
                <!-- This will be populated with color details on click -->
              </div>
            {% endfor %}
          </div>
        </div>


        <div class="section">
          <div class="option-header"><strong>WHEELS</strong></div>
          <div class="wheels-container">
            {% for wheel in wheels %}
              <div class="wheel-option" style="text-align: center; cursor: pointer;">
                <div class="wheel-name" data-wheel-id="{{ wheel.id }}" data-price="{{ wheel.price }}" title="{{ wheel.size }} - {{ wheel.style }}">
                  {{ wheel.size }} - {{ wheel.style }}
                </div>
              </div>
            {% endfor %}
          </div>
        </div>
      
        <div class="section">
          <div class="option-header"><strong>ENGINES</strong></div>
          <div class="engines-container">
            {% for engine in engines %}
              <div class="engine-option" style="text-align: center; cursor: pointer;">
                <div class="engine-name" data-engine-id="{{ engine.id }}" data-price="{{ engine.price }}" title="{{ engine.name }} - {{ engine.power }} HP">
                  {{ engine.name }} - {{ engine.power }} HP
                </div>
              </div>
            {% endfor %}
          </div>
        </div>
        </div>




        <div class="config-summary-container">
          
            <h3>Configuration Summary</h3>
            <p>Selected Engine: <span id="selectedEngine">-</span></p>
            <p>Selected Color: <span id="selectedColor">-</span></p>
            <p>Selected Wheels: <span id="selectedWheel">-</span></p>
            <p><strong>Total Price: <span id="totalPriceDisplay">0.00</span> €</strong></p>
          
       
        </div>

      </div>



      
        <form method="post"  >
          {% csrf_token %}
          <div style="display: none;">
          <label for="engine">Engine</label>
          <select id="engine" name="engine">
            {% for engine in engines %}
              <option value="{{ engine.id }}" data-price="{{ engine.price }}" {% if engine.price == 0 %}selected{% endif %}>
                {{ engine.name }} - {{ engine.power }} HP
              </option>
            {% endfor %}
          </select>
          

            
            <label for="color">Choose color:</label>
            <select id="color" name="color">
              {% for color in colors %}
              <option 
              value="{{ color.id }}"
              data-price="{{ color.price }}"
              data-images='[{% for img in color.images.all %}"{{ img.image.url }}"{% if not forloop.last %}, {% endif %}{% endfor %}]'
              {% if color.price == 0 %}selected{% endif %}>
              {{ color.name }}
            </option>
            {% endfor %}
          </select>
       
        
        
          <label for="wheel">Choose wheels:</label>
          <select id="wheel" name="wheel">
            {% for wheel in wheels %}
              <option value="{{ wheel.id }}" data-price="{{ wheel.price }}" {% if wheel.price == 0 %}selected{% endif %}>
                {{ wheel.size }} - {{ wheel.style }}
              </option>
            {% endfor %}
          </select>
        
          <p>Base price: <span id="basePrice">{{ car.base_price }}</span> €</p>
          <p><strong>Total price: <span id="totalPrice"></span> €</strong></p>
        
          <button type="submit" style="margin-top: 10px; padding: 10px 20px;">Save Configuration</button>
        </form>
    


    



    <script>
      const track = document.querySelector(".carousel-track");
      let images = document.querySelectorAll(".carousel-image");
      const prevBtn = document.querySelector(".carousel-btn.prev");
      const nextBtn = document.querySelector(".carousel-btn.next");
      let currentIndex = 0;
      
      function updateCarousel() {
        images = document.querySelectorAll(".carousel-image"); // update reference
        if (images.length === 0) return;
        const width = images[0].clientWidth;
        track.style.transform = `translateX(-${currentIndex * width}px)`;
      }
      
      // ✅ Color circle click logic
      document.querySelectorAll(".color-circle").forEach(circle => {
        circle.addEventListener("click", function () {
          const imagesData = this.dataset.images;
          const colorId = this.dataset.colorId;
      
          try {
            const imageUrls = JSON.parse(imagesData.replace(/'/g, '"'));
      
            const carouselTrack = document.querySelector(".carousel-track");
            const newImages = imageUrls
              .map((url, index) => `<img src="${url}" class="carousel-image" alt="Color image ${index + 1}">`)
              .join("");
      
            carouselTrack.innerHTML = newImages;
      
            // Reset index and update references
            currentIndex = 0;
            images = document.querySelectorAll(".carousel-image");
            updateCarousel();
          } catch (e) {
            console.error("Failed to load images for selected color:", e);
          }
      
          const selectedOption = document.querySelector(`#color option[value="${colorId}"]`);
          const colorName = selectedOption.textContent.trim();
          const colorPrice = selectedOption.dataset.price;
      
          // Hide all other color info divs
          document.querySelectorAll(".color-info").forEach(infoDiv => {
            infoDiv.style.display = "none";
          });
      
          // Display the price for the selected color
          const selectedPriceDiv = document.getElementById(`colorInfo-${colorId}`);
          if (selectedPriceDiv) {
            selectedPriceDiv.style.display = "block"; // Show the price for the selected color
            selectedPriceDiv.innerHTML = `${colorPrice} €`; // Update the price displayed
          }
      
          // Update the color select dropdown to match the clicked color
          const colorSelect = document.getElementById("color");
          colorSelect.value = colorId;
          updateTotalPrice(); // Update the total price based on new color selection
        });
      });
      
      nextBtn.addEventListener("click", () => {
        currentIndex = (currentIndex + 1) % images.length;
        updateCarousel();
      });
      
      prevBtn.addEventListener("click", () => {
        currentIndex = (currentIndex - 1 + images.length) % images.length;
        updateCarousel();
      });
      
      window.addEventListener("resize", updateCarousel);
      
      function getSelectedOptionPrice(selectId) {
        const select = document.getElementById(selectId);
        if (!select || select.selectedIndex === -1) return 0;
        const selectedOption = select.options[select.selectedIndex];
        return parseFloat(selectedOption.dataset.price || 0);
      }
      
      function updateTotalPrice() {
        const basePrice = parseFloat(document.getElementById("basePrice").innerText);
        const engineSelect = document.getElementById("engine");
        const colorSelect = document.getElementById("color");
        const wheelSelect = document.getElementById("wheel");

        const enginePrice = getSelectedOptionPrice("engine");
        const colorPrice = getSelectedOptionPrice("color");
        const wheelPrice = getSelectedOptionPrice("wheel");

        const total = basePrice + enginePrice + colorPrice + wheelPrice;

        document.getElementById("totalPrice").innerText = total.toFixed(2);
        document.getElementById("totalPriceDisplay").innerText = total.toFixed(2);

        // Update display texts
        document.getElementById("selectedEngine").innerText = engineSelect.options[engineSelect.selectedIndex].text;
        document.getElementById("selectedColor").innerText = colorSelect.options[colorSelect.selectedIndex].text;
        document.getElementById("selectedWheel").innerText = wheelSelect.options[wheelSelect.selectedIndex].text;
}




        document.querySelectorAll(".wheel-name").forEach(wheel => {
                wheel.addEventListener("click", function() {
                    const wheelId = this.dataset.wheelId;
                    const wheelPrice = parseFloat(this.dataset.price);
                    
                    // Set the selected wheel in the dropdown
                    document.getElementById("wheel").value = wheelId;
                    
                    // Manually trigger the total price update
                    updateTotalPrice();
                });
            });

        document.querySelectorAll(".engine-name").forEach(engine => {
            engine.addEventListener("click", function() {
                const engineId = this.dataset.engineId;
                const enginePrice = parseFloat(this.dataset.price);
                
                // Set the selected engine in the dropdown
                document.getElementById("engine").value = engineId;
                
                // Manually trigger the total price update
                updateTotalPrice();
            });
        });
      
      // Update price when engine, color, or wheel changes
      document.getElementById("engine").addEventListener("change", updateTotalPrice);
      document.getElementById("color").addEventListener("change", updateTotalPrice);
      document.getElementById("wheel").addEventListener("change", updateTotalPrice);
      
      // ✅ On page load: initialize total price and simulate click on default color
      window.addEventListener("load", () => {
        updateTotalPrice();
        updateCarousel();
      
        const defaultColorOption = document.querySelector("#color option[selected]");
        if (defaultColorOption) {
          const defaultColorId = defaultColorOption.value;
          const colorCircle = document.querySelector(`.color-circle[data-color-id="${defaultColorId}"]`);
          if (colorCircle) {
            setTimeout(() => colorCircle.click(), 50); // delay ensures images render first
          }
        }
      });
    </script>
    
    
  </body>
</html>
{% endblock %}