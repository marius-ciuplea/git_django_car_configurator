{% extends "base.html" %} {% load static %} {% block content %}
<link rel="stylesheet" href="{% static 'styles/profile_style.css' %}" />

<!-- Profile section with picture and title together -->

<div class="profile-container">
  <div class="profile-name">
    {% if profile.profile_picture %}
    <img
      src="{{ profile.profile_picture.url }}"
      alt="Profile Picture"
      class="profile-picture-top"
    />
    {% endif %}
    <h1>{{ profile.user.username|title }}'s Profile</h1>
  </div>

  <!-- Main content aligned to the left -->
  <div class="profile-main-content">
    <div class="profile-left">
      {% if not edit_mode %}
      <!-- Profile details section -->
      <div class="profile-details">
        <div class="profile-item">
          <h2>Profile Details</h2>
        </div>
        <div class="profile-item">
          <strong>Username:</strong>
          <p>{{ profile.user.username }}</p>
        </div>
        <div class="profile-item">
          <strong>Email:</strong>
          <p>{{ profile.user.email }}</p>
        </div>

        <div class="action-button edit-profile">
          <a href="{% url 'view_profile' %}?edit=true">Edit Profile</a>
        </div>
      </div>

      <!-- User messages section -->
    </div>
    <div class="messages-container">
      <h2>Your Messages</h2>
      {% if user_messages %}
      <div class="messages-list">
        {% for msg in user_messages %}
        <div class="message-card" id="message-{{ msg.id }}">
          <p class="message-date">
            <strong>Sent:</strong> {{ msg.created_at|date:"Y-m-d H:i" }}
          </p>
          <p class="message-content">{{ msg.message|linebreaksbr }}</p>
          <input
            type="hidden"
            id="csrf-token"
            name="csrfmiddlewaretoken"
            value="{{ csrf_token }}"
          />
          <button class="delete-btn" data-id="{{ msg.id }}">Delete</button>
        </div>
        {% endfor %}
      </div>
      {% else %}
      <p class="no-messages">You havenâ€™t sent any messages yet.</p>
      {% endif %}
    </div>
    {% else %}
    <!-- Edit Profile Form -->
    <form method="post" enctype="multipart/form-data" class="profile-form">
      {% csrf_token %}

      <div class="form-group">
        <label for="{{ user_form.username.id_for_label }}">Username:</label>
        <div class="input-field">{{ user_form.username }}</div>
      </div>

      <div class="form-group">
        <label for="{{ user_form.email.id_for_label }}">Email:</label>
        <div class="input-field">{{ user_form.email }}</div>
      </div>

      <div class="profile-upload-picture-section">
        {% if profile.profile_picture %}
        <img
          src="{{ profile.profile_picture.url }}"
          alt="Current Profile Picture"
          class="current-profile-picture"
        /><br />
        {% endif %}

        <label for="id_profile_picture">Choose new picture:</label><br />
        <input type="file" name="profile_picture" id="id_profile_picture" class="custom-file-input" />
        <br /><br />
      </div>

      <!-- {{ profile_form.profile_picture }} -->

      <div class="action-button password_change">
        <a href="{% url 'password_change' %}">Change Password</a>
      </div>

      <div class="buttons-container-form">
        <a href="{% url 'view_profile' %}" class="discard-button">Discard</a>
        <button type="submit" class="save-button">Save</button>
      </div>
    </form>
    {% endif %}
  </div>
</div>

<div id="confirmModal" class="modal-overlay" style="display: none">
  <div class="modal">
    <p>Are you sure you want to delete this message?</p>
    <div class="modal-buttons">
      <button id="confirmDelete" class="modal-confirm">Yes</button>
      <button id="cancelDelete" class="modal-cancel">No</button>
    </div>
  </div>
</div>

<script>
  const deleteUrl = "{% url 'delete_message_ajax' %}";
</script>
<!-- JavaScript to handle message deletion -->
<script src="{% static 'js/profile.js' %}"></script>
{% endblock %}
